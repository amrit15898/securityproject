{% extends "base.html" %}
{% block content %}
 
{% include "datatable.html" %}
<main class="bg-white pb-4 rounded">
    {% load static %}
<div class="col-md-9 col-lg-12 px-md-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 ">
      <h1 class="h2">Grid Csv data adding logs</h1>
    </div>
  </div>

   <div class="col-md-9 col-lg-12 px-md-4 mt-4  point-table">

   

<table id="example" class="table table-striped table-content d-none" style="width:100%">
        <thead>
            <tr>
                <th>Name</th>
                <th>sect id</th>
                <th>Forecast Area</th>
                <th>Grids</th>
                <th class="action-inner">Logs</th>
            </tr>
        </thead>
        <tbody>
  
        </tbody>
    </table>


    <div class="position-absolute mt-5" id="loader" style="margin-left:27%;">
        <div>
            <img src="{% static 'images/loader-unscreen.gif' %}" width="200px" alt="">
        <h5 class="ms-1">Please wait data is loading...</h5>
        </div>
    </div>  

   </div>


</main>
   
    <link rel="stylesheet" href="{% static 'css/toastr.css'%}">
  <script src="{% static 'js/toastr.js'%}"></script>
<script>
 
 function make_datatable(){
    $(document).ready(function () {
        $('#example').DataTable();
    });
 }
  

  $.ajax({
    type: 'GET',
    url: "http://127.0.0.1:8000/weather/grid-csv-data/",
    success:function(data){
        $('#loader').addClass("d-none")
        $('#example').removeClass("d-none")
        make_datatable()
      data.forEach(Add_row_dt);
    }
});


function grids(id,grids){
   return  `
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#more`+id+`">Grids</i></button></td>
    <div class="modal fade" id="more`+id+`" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5 text-capitalize" id="staticBackdropLabel">Grid ids</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
               <p class="text-break">`+grids+`</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
            </div>
        </div>
        </div>
    `
}


function log_message(array){
    console.log(value)
    return "her"
}

function logs_show(id,message){
    if(message.length > 0){
        return `
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#moree`+id+`">Error</i></button></td>
        <div class="modal fade" id="moree`+id+`" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5 text-capitalize" id="staticBackdropLabel">Logs Message</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                   <p class="text-break">`+message+`</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
                </div>
            </div>
            </div>
    
        `
    }
    else{
        return `<p class="text-success">Created successfully</p>`
    }
   
}


var t = $('#example').DataTable();
function Add_row_dt(item) {
    t.row.add([item.name,item.sect_id,item.forecast_area,grids(item.id,item.grids), logs_show(item.id,item.message)]).draw(false);
  }

</script>

{% if updated %}
  <script>
        toastr.options.timeOut = 2500; // 2.5s
        toastr.options = {
        "closeButton": false,
        "debug": false,
        "newestOnTop": false,
        "progressBar": false,
        "positionClass": "toast-bottom-right",
        "preventDuplicates": false,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
        }
        toastr.success("Grid updated successfully");
    </script>
  {% elif not_update %}
    <script>
        toastr.options.timeOut = 2500; // 1.5s
        toastr.options = {
        "closeButton": false,
        "debug": false,
        "newestOnTop": false,
        "progressBar": false,
        "positionClass": "toast-bottom-right",
        "preventDuplicates": false,
        "showDuration": "300",
        "hideDuration": "1000",
        "timeOut": "5000",
        "extendedTimeOut": "1000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
        }
        toastr.warning("Grid updated failed try again");
    </script>
  {% endif %}


  {% if not_update %}
<script>
    $(window).on('load', function() {
        $('#update{{instance.id}}').modal('show');
    });
</script>
{% endif %}


 {% endblock %}
